---
title: "Networking Basic Concepts"
weight: 2
# bookFlatSection: false
# bookToc: true
# bookHidden: false
# bookCollapseSection: false
# bookComments: false
# bookSearchExclude: false
---

## 数据链路层

### mac地址
1. mac地址长度：48比特（6字节）。如：ether c4:b3:01:d1:7b:ef
2. mac地址的唯一性
理论上，mac地址是全世界唯一的。但是也有例外情况，比如虚拟机的网卡。但只要保证同一数据链路种唯一就不会出现问题。

## IP协议
IP协议属于面向无连接。需要有连接时，可以委托上一层提供此项服务。

### IPv4
IPv4地址长度32比特（4字节）。主要由两部分组成：网络标识（网络地址）和 主机标识（主机地址）。如：inet 172.31.99.91 netmask 0xfffffc00 broadcast 172.31.99.255

##### IPv4地址分类：
- A类：网络标识以0开头，到第8位
- B类：网络标识以10开头（0b10000000=128），到第16位
- C类：网络标识以110开头（0b11000000=192），到第24位
- D类：网络标识以1110开头（0b11100000=224），到第32位（即没有主机标识，常用于多播）

##### 广播地址
IP地址中，主机地址全部设置为1
- 本地广播 路由会屏蔽本网络内的广播地址，因此IP包不会到达其他链路
- 直接广播 向其他网络发送广播消息（直接广播会有安全问题，所以一般路由器上设置不转发）

##### IP多播 
IP多播使用D类地址（即1110开头的IP地址, 0b11100000 = 224)，剩下的28位为多播组编号。 对于多播，所有的主机必须属于224.0.0.1的组，所有的路由器必须属于224.0.0.2的组。224.0.0.0-224.0.0.255不需要路由控制，在同一链路内也能实现多播。

##### 私有网络：
   - A类：10.0.0.0-10.255.255.255(10/8 = 00001010)
   - B类：172.16.0.0-172.31.255.255（172.16/12 = 10101100.0001）
   - C类：192.168.0.0-192.168.255.255（192.168/16 = 11000000.10101000）

#### 路由控制
1. 默认路由： 0.0.0.0/0或default
2. 主机路由：IP地址/32
3. 环回地址：127.0.0.1或localhost（主机名）。环回地址是同一台计算机上的程序之间进行网络通信时所使用的一个默认地址，使用该地址时，数据包不会流向网络。

#### IP报文分片与重组
1. MTU（Maximum Transmission Unit，最大传输单元）。每种数据链路的最大传输单元都不尽相同。IP抽象化了底层的数据链路。
2. 路由器进行分片，但不进行重组，重组由目标主机进行。分片以8个字节的倍数为单位进行。
3. 路径MTU即路径中存在的所有数据链路中最小的MTU。使用路径MTU发现，分片可以由发送主机进行，避免在中途的路由器上进行分片处理（IP首部的分片标志设置为不分片）。

IP包首部16-31位（16比特）存储IP包的总字节数。所以IP包的最大长度为65535（2^16）字节。片偏移占13比特，因此最多可表示8192个相对位置。IP包的分片以8个字节的倍数为单位进行，所以最大可表示的原始数据长度为65535。
```math
65535 = 2^{16} = 2^{(3+13)} =  2^3 * 2^{13} = 8 * 8192
```

IP包首部的4-7位（4比特）存储首部长度，可表示2^4-1=15,单位是4字节（32比特）。其中，版本和长度等信息存入首部第一个4字节，分片标识和偏移信息存入第二个4字节，TTL和协议及校验和存入第三个4字节，源地址存入第四个4字节，目标地址存入第五个4字节（ip地址的长度为四个字节，4x8 = 32个比特），最后是可选项（长度可变，用于实验和诊断）加填充（padding，用于长度对齐，调整为32比特的整数倍）。在没有可选项的情况下，首部长度设置为5（即IP首部长度20字节，5x4）。

### IPv6
IPv6长度为128比特（16字节），是IPv4的4倍。一般写成8个16位字节，即每16个比特一组，每组用冒号分割，如果出现连续的0可以省略，但一个IP地址只允许一次两个联系的冒号。如：inet6 fe80::a00a:deff:fe47:7fdb

1. 全局单播地址
全局单播地址格式：前64比特（n=48,全局路由前缀; m=16,子网ID）位网络标识，后64比特位主机标识（接口ID）。
2. 链路本地单播地址
指同一个数据链路内的唯一地址。以1111111010（10比特）开头。用于不经过路由器，在同一个链路中通信。
3. 唯一本地地址
以1111110（7比特）+L（1比特，通常设置成1）开头。不进行互联网通信时使用的地址。

IPv6的分片处理只在发送端进行，路由器不参与分片。不过IPv6中最小MTU位1280字节。

IPv6首部长度固定（5个8字节 = 40个字节 = 320比特），为了让64位CPU处理方便，IPv6的首部及可选项都由8字节构成。
